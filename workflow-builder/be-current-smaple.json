{
  "name": "High Value Customer Follow-up",
  "version": "1.0",
  "status": "draft",
  "merchantId": "SHOP001",
  "trigger_type": "event",
  "actions": [
    {
      "action_id": "contact-enrollment-trigger",
      "key": "a1",
      "type": "trigger",
      "config": {
        "event": "user_info_updated", 
        "merchantId": "SHOP001",       
        "dataSource": "CRM",
        "condition":"true"
      },
      "mapper": null
    },
    {
      "action_id": "query-action",
      "key": "a2",
      "type": "condition",
      "info":{
        
      },      
      "mapper": {
         "query": {
            "mode": "expression",
            "value": "{\"users\":{\"limit\":5,\"select\":[\"user_id\",\"first_name\",\"last_name\",\"points_balance\",\"id_card\"],\"where\":{\"and\":[{\"status\":\"ACTIVE\"},{\"points_balance\":{\"\\u003e\":100}},{\"user_id\":\"684bc1b694537bbbc606660a\"}]}}}"
        }
      }
    },
    {
      "action_id": "slack-action",
      "key": "a3",
      "type": "action",
      "info": {
        "actionType": "generic",
        "message": "ðŸŽ‰ High-value customer alert! ${customer_name} just placed a ${order_total} order. Consider reaching out for personalized service.",
        "channel": "#customer-success",
        "username": "Order Bot"
      },
      "config":{},
      "mapper": {
          "value": {
              "mode": "expression",
              "value": "'Send Line notification for total sale greater than 20000 bth to user id is ' + builtin.string(a2.output.value.id) + ' ' + builtin.string(a2.output.value.first_name) + ' ' + builtin.string(a2.output.value.last_name)'"
          }
      }
    }
  ],
  "peers": [
    {
      "parent_key": "a1",
      "child_key": "a2",
      "meta_output": "triggered"
    },
    {
      "parent_key": "a2",
      "child_key": "a3",
      "meta_output": "yes"
    },
    {
      "parent_key": "a2",
      "child_key": "a3",
      "meta_output": "no"
    }
  ]
}